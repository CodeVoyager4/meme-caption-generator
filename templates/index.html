{% extends "base.html" %}

{% block title %}AI Meme Generator{% endblock %}

{% block nav %}
<div></div>
<h1>Far Side-Style Caption Generator</h1>
<a href="{{ url_for('history') }}">View History â†’</a>
{% endblock %}

{% block content %}
<div class="card">
    <div class="form-container">
        <form method="POST">
            <input class="url-input" type="text" name="image_url" 
                   placeholder="Paste your image URL here" required>
            <div class="model-selection">
                <label>
                    <input type="radio" name="model_choice" value="xai" checked>
                    X.AI (Grok Vision)
                </label>
                <label>
                    <input type="radio" name="model_choice" value="openai">
                    OpenAI (GPT-4 Vision)
                </label>
            </div>
            <button class="button" type="submit">Generate Caption</button>
        </form>
    </div>
</div>

{% if error %}
<div class="error">{{ error }}</div>
{% endif %}

{% if result %}
<div class="result">
    {% if captioned_image %}
    <div class="generated-meme">
        <h2>Your Generated Meme</h2>
        <img src="{{ url_for('serve_saved_image', filename=captioned_image) }}" 
             alt="Captioned image">
    </div>
    {% endif %}
    
    <div class="analysis-grid">
        <div class="image-container">
            <h3>Original Image</h3>
            <img src="{{ request.form.get('image_url') }}" alt="Original image">
        </div>
        <div class="description">
            <h3>AI Analysis</h3>
            <pre>{{ result }}</pre>
        </div>
    </div>
</div>
{% endif %}

<div class="section">
    <h2>Choose an Image from Reddit</h2>
    <div class="image-grid">
        {% for image in reddit_images %}
        <div class="image-card">
            <img src="{{ image.url }}" alt="{{ image.title }}" 
                 onclick="selectImage('{{ image.url }}')"
                 onerror="this.src='/static/placeholder.png'">
            <div class="image-info">
                <p class="image-title">{{ image.title[:50] }}...</p>
                <span class="subreddit">r/{{ image.subreddit }}</span>
            </div>
        </div>
        {% endfor %}
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
function selectImage(url) {
    document.querySelector('.url-input').value = url;
    document.querySelector('.url-input').scrollIntoView({ behavior: 'smooth' });
}
</script>
{% endblock %} 